name: è®¢é˜…èŠ‚ç‚¹æ›´æ–°

on:
    # å®šæ—¶è§¦å‘
    schedule:
        - cron: '0 */8 * * *' # æ¯8å°æ—¶æ‰§è¡Œä¸€æ¬¡

    # æ‰‹åŠ¨è§¦å‘
    workflow_dispatch:
        inputs:
            reason:
                description: 'è§¦å‘åŸå› '
                required: false
                default: 'æ‰‹åŠ¨è§¦å‘æ›´æ–°'
    workflow_call:
        secrets:
            SUBS:
                required: true

jobs:
    update-nodes:
        runs-on: ubuntu-latest

        steps:
            - name: æ£€å‡ºä»£ç 
              uses: actions/checkout@v4

            - name: è®¾ç½® Node.js ç¯å¢ƒ
              uses: actions/setup-node@v4
              with:
                  node-version: latest

            - name: è®¾ç½® pnpm
              uses: pnpm/action-setup@v4
              with:
                  version: latest

            - name: å®‰è£…ä¾èµ–
              run: pnpm install --no-frozen-lockfile

            - name: è¿è¡Œæ›´æ–°è„šæœ¬
              run: pnpm run prod
              env:
                  SUBS: ${{ secrets.SUBS }}

            - name: æäº¤æ›´æ”¹
              run: |
                  git config --local user.email "github-actions[bot]@users.noreply.github.com"
                  git config --local user.name "github-actions[bot]"
                  git add address
                  git commit -m "ğŸ”„ è‡ªåŠ¨æ›´æ–°èŠ‚ç‚¹: $(date '+%Y-%m-%d %H:%M:%S')"
                  git push

